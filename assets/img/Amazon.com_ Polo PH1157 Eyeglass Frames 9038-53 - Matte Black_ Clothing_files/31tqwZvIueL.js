(function(p,n,v){p.execute(function(){p.when("twister-variation-matrix","twister-dim-util","twister-state-machine","twister-metadata","twister-view-controller","twister-dispatcher","twister-actions","twister-slots-dimsum","twister-dimsum").register("TwisterCore",function(d,h,g,e,c,b,f,m,a){function l(f,k){this.tvm=new d(f);this.util=new h(this.tvm);this.tsm=new g(this.tvm,this.util,f.initDimCombination);this.dimSum=new a(f.config.ajaxTimeout,f.config.ajaxUrlParams,f.config.deviceType,k);this.slotsDimSum=
new m(f.config.ajaxTimeout,f.config.ajaxUrlParams,f.config.deviceType);var l=this;b.registerStore("twister-state-machine",function(a,b){l.tsm.accept(a,b).THEN(function(b){c.publishView(a,b)}).ELSE()});var n=new e;b.registerStore("twister-metadata",function(a,b){n.process(a,b,function(b){c.publishView(a,b)})})}function k(a,c){var d=a.viewAttribution+"_"+a.viewName+"_"+c;return function(a){try{var e=f.create(c,a);b.dispatch(c,e)}catch(g){n.ueLogError&&n.ueLogError(g,{logLevel:"ERROR",attribution:"Twister_view_"+
d,message:"This error is caused by the Twister view - "+d+" while updating the TwisterCore"})}}}l.prototype={registerActive:function(a,b){c.register(a.viewAttribution+"_"+a.viewName,b.updateView);return{dimensionChanged:k(a,"VARIATION_CHANGE"),dimensionPeek:k(a,"VARIATION_PEEK"),metaData:k(a,"METADATA")}},registerPassive:function(a,b){c.register(a.viewAttribution+"_"+a.viewName,b.updateView);return{metaData:k(a,"METADATA")}},state:function(){return this.tsm.currentState().selected().selectionInfo()}};
return l});p.when("A").register("twister-actions",function(d){var h=d.$,g={VARIATION_CHANGE:function(d){return d=h.isArray(d)?d:[d]},VARIATION_PEEK:function(d){return d},METADATA:function(d){return d}};return{create:function(d,c){return g[d]?g[d](c):!1}}});p.when("A","publisherSubscriber").register("twister-dispatcher",function(d,h){function g(){g=1;return this}var e=d.$,c=new h,g=0,b=[];return{registerStore:function(b,d){c.register(b,d);return this},deregisterStore:function(b){c.deRegister(b);
return this},dispatch:function(d,e){g?b.push(arguments):c.publish(d,e);return this},hold:g,release:function(){e.each(b,function(b,d){c.publish.apply(c,d)});g=0;return this}}});p.when("A","publisherSubscriber").register("twister-view-controller",function(d,h){function g(){c?b.push(arguments):(c=1,e.publish.apply(e,arguments),c=0,b.length&&g.apply(this,b.shift()));return this}var e=new h,c=0,b=[];return{register:function(b,c){e.register(b,c);return this},deRegister:function(b){e.deRegister(b);
return this},publishView:g}});p.when("A").register("twister-dimsel-api",function(d){function h(d){var c=this;this.dimSelectionMap={};this.selInfo=d;g.each(d,function(b,d){c.dimSelectionMap[d.dimKey]=d.val})}var g=d.$;h.prototype={matches:function(d){d=d.selectionInfo();for(var c=0;c<d.length;c++){var b=d[c].dimKey;if(!(b in this.dimSelectionMap)||this.dimSelectionMap[b]!==d[c].val)return!1}return!0},selectionInfo:function(){return d.copy(this.selInfo)}};return h});p.when("A",
"twister-dimsel-api").register("twister-dim-util",function(d,h){function g(c){this.tvm=c;this.dimensionMetaData={};var b=[];c=c.dimensionInfo;for(var d=0;d<c.length;d++){b.push(c[d].dimKey);var e={};e.isRequired=c[d].isRequired;e.dimOrder=d;e.size=c[d].size;this.dimensionMetaData[c[d].dimKey]=e}}var e=d.$;g.prototype={createSelectionInfo:function(c){return new h(c)},extendSelectionInfo:function(c,b,d){var g=d||0===d,a={},l=[];e.each(b.selectionInfo(),function(b,c){a[c.dimKey]=c.val});e.each(c.selectionInfo(),
function(b,c){var e=c.dimKey,h=g?d:c.val;e in a&&(h=a[e]);l.push({dimKey:e,val:h})});return new h(l)},createNextDimSelection:function(c,b){var d=[],g=b.selectionInfo(),a=this;e.each(c.split(":"),function(b,c){var e=g[b].dimKey,h=parseInt(c,10);a.dimensionMetaData[e].isRequired&&h!==g[b].val&&(h=-1);d.push({dimKey:e,val:h})});return new h(d)},getDimScore:function(c,b){var d=0,g=c.split(":"),a=this;e.each(b.selectionInfo(),function(b,c){var e=c.dimKey,h=c.val,n=parseInt(g[b],10),p=g.length-b;h===n?
(d+=200*p,a.dimensionMetaData[e].isRequired&&(d+=2E4)):(h=Math.abs(h-n),e=Math.round(h/a.dimensionMetaData[e].size*100),d+=100-e)});return d},isSingletonDim:function(c){var b=0;this.tvm.config.isSingletonWeblabEnabled?1===this.tvm.dimtoValueMap[c].length&&(b=1):b=0;return b},isRequiredDim:function(c){return this.dimensionMetaData[c]?this.dimensionMetaData[c].isRequired:!1},getDimensionInfo:function(){return this.tvm.dimensionInfo},getDimAvailability:function(c,b){b=b.selectionInfo?b:this.createSelectionInfo(b);
var d=[],g=[],a=this.tvm.dimensionList,h=this.tvm.dimtoValueMap[c],k=this.createSelectionInfo([{dimKey:c,val:-1}]),k=this.tvm.fetch(this.extendSelectionInfo(b,k).selectionInfo()),n={},p=this;e.each(k,function(b,d){n[d.split(":")[a.indexOf(c)]]=p.tvm.dimCombinations[d]});e.each(h,function(a,b){a in n?d.push({index:a,asin:n[a],label:b}):g.push({index:a,label:b})});return{available:d,unavailable:g}},getUnselectedDims:function(c){var b={};e.each(c,function(a,c){b[c.dimKey]=c.val});c=[];var d=this.tvm.dimensionList,
g;for(g in d)if(d.hasOwnProperty(g)){var a=d[g];if(b[a]===v||-1===b[a])this.isSingletonDim(a)?b[a]=0:c.push(a)}return c},showDimSum:function(c,b){var d=this.getUnselectedDims(b);return!d||0===d.length||1===d.length&&d[0]===c?1:0},isFullySelected:function(c){var b=!0;"string"===typeof c&&(c=this.getSelectionInfoFromDimComb(c));c=c.selectionInfo?c.selectionInfo():c;if(c.length!=this.tvm.dimensionList.length)return!1;e.each(c,function(c,d){-1===d.val&&(b=!1)});return b},createDimensionSelectionMap:function(c){var b=
{},d;for(d in c)if(c.hasOwnProperty(d)){var e=c[d];b[e.dimKey]=e.val}return b},getSelectedDimKeys:function(c){var b=this.tvm.dimensionList,d=[],e;for(e in b)if(b.hasOwnProperty(e)){var a=c[b[e]];"undefined"===typeof a||-1==a?d.push("*"):d.push(a)}return d},getValidDimCombination:function(c,b){var d,g,a=this,h=0,k=0;g=this.tvm.fetch(c);e.each(g,function(c,e){k=a.getDimScore(e,b);k>h&&(d=c,h=k)});return g[d]},getAsinFromSelectionInfo:function(c,b){var f,g;"undefined"==typeof b||b?f=this.createDimensionSelectionMap(c):
(g=d.copy(c),f=this.getValidDimCombination(g,this.createSelectionInfo(c)),e.each(f.split(":"),function(a,b){var c=parseInt(b,10);g[a].val=c}),f=this.createDimensionSelectionMap(g));f=this.getSelectedDimKeys(f).join(":");return this.tvm.dimCombinations[f]},getSelectionInfoFromSelectedVariationValuesMap:function(c){var b=[],d;for(d in this.tvm.dimensionList){var e={},a=this.tvm.dimensionList[d];e.dimKey=a;e.val=c[a];b.push(e)}return b},getSelectionInfoFromDimComb:function(c){var b=[];c=c.split("_");
for(var d in this.tvm.dimensionList){var e={},a=c[d];e.dimKey=this.tvm.dimensionList[d];e.val="X"===a||"*"===a?-1:parseInt(a,10);b.push(e)}return b}};return g});p.when("A","url-builder").register("twister-dimsum",function(d,h){function g(c,b,e,g){this.cache;g&&(this.cache=new g);this.ajaxTimeout=c;this.batchLimit=10;this.ajaxUrl="/gp/twister/dimension?asinList=###asinString###&vs=1"+(b||"");e&&(this.ajaxUrl+="&deviceType="+e);(c=d.state("pwState"))&&c.isTryState&&(this.ajaxUrl=h.addUrlParams(this.ajaxUrl,
{isTryState:"true"}))}var e=d.$;g.prototype={get:function(c,b,f){function g(b){var c=b-this.batchLimit,e="";0<c&&g.call(this,c);if(e=n.slice(0>c?0:c,b).join(","))b=this.ajaxUrl.replace("###asinString###",e),d.ajax(b,{chunk:a,timeout:this.ajaxTimeout})}function a(a){if(a)for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];if(d&&d.asin){if(k){var e=h(d.asin,f);k.put(e,d)}b&&b(d)}}}function h(a,b){var c=a;d.objectIsEmpty(b)||(c={asin:a},e.extend(!0,c,b));return c}var k=this.cache,n=[],p={};e.each(c,function(a,
c){var d=h(c,f);k&&k.get(d)?b?b(k.get(d)):p[c]=k.get(d):n.push(c)});if(!b)return p;g.call(this,n.length)}};return g});p.when("A").register("twister-slots-dimsum",function(d){function h(b,c,d){this.cache=e;this.ajaxTimeout=b;this.batchLimit=8;this.ajaxUrl="/gp/twister/dimension?isDimensionSlotsAjax=1&asinList=###asinString###&vs=1"+(c||"");d&&(this.ajaxUrl+="&deviceType="+d)}var g=d.$,e={},c={};h.prototype={get:function(b,e){function h(b){var c=b-this.batchLimit,e="",f=[];0<c&&h.call(this,
c);f=n.slice(0>c?0:c,b);if(e=f.join(","))b=this.ajaxUrl.replace("###asinString###",e),d.ajax(b,{chunk:l,timeout:this.ajaxTimeout,cache:!0,error:a.apply(null,f)})}function a(){var a=arguments;return function(){d.each(a,function(a){delete c[a]})}}function l(a){if(a&&a.ASIN){var b=a.ASIN;k[b]=a;for(e&&e(a);c[b]&&c[b].length;)c[b].pop()(a);delete c[b]}}var k=this.cache,n=[],p={};g.each(b,function(a,b){k[b]?e?e(k[b]):p[b]=k[b]:c[b]&&e?c[b].push(e):e&&(n.push(b),c[b]=[])});if(!e)return p;n.length&&h.call(this,
n.length)}};return h});p.register("twister-metadata",function(){function d(){this.config={}}d.prototype={process:function(d,g,e){"METADATA"===d&&e(g)}};return d});p.when("A").register("publisherSubscriber",function(d){function h(){this.Subscribers=[];this.Names=[]}var g=d.$;h.prototype={register:function(e,c){if(-1<d.indexOfArray(this.Names,e))return!1;this.Names.push(e);this.Subscribers.push({name:e,handler:c})},deRegister:function(e){var c=d.indexOfArray(this.Names,e),
b=this,f=function(c,a){if(c.name===e)return b.Subscribers.splice(a,1),!0};return-1<c?(this.Names.splice(c,1),[].some?this.Subscribers.some(f):g.each(this.Subscribers,function(b,a){f(a,b)}),!0):!1},publish:function(){var d=arguments;g.each(this.Subscribers,function(c,b){setTimeout(function(){b.handler.apply(null,d)},0)})}};return h});p.when("jQuery").register("twister-state-machine",function(d){return function(h,g,e){function c(a,b){this.selected=function(){return a};this.peek=function(){return b}}
function b(a,b){var c=g.extendSelectionInfo(a,b);if(f(b)||h.exists(c.selectionInfo()))return c;for(var d=g.extendSelectionInfo(a,b,-1),d=h.fetch(d.selectionInfo()),e=0,l=0,m,n=0;n<d.length;n++)l=g.getDimScore(d[n],c),l>e&&(m=n,e=l);return g.createNextDimSelection(d[m],c)}function f(a){var b;d.each(a.selectionInfo(),function(a,c){b=-1===c.val});return b}function m(a,b){return{THEN:function(c){a&&c&&c(b());return this},ELSE:function(c){a||c&&c(b());return this}}}var a,l;this.accept=function(d,e){var f;
switch(d){case "VARIATION_PEEK":var h=g.createSelectionInfo([e]);f=a();f.peek().matches(h)?f=!1:(-1===e.val?f=new c(a.selected(),a.selected()):(h=b(f.peek(),h),f=new c(f.selected(),h)),l=f,f=!0);f=m(f,this.currentState);break;case "VARIATION_CHANGE":f=a();var h=g.createSelectionInfo(e),n=g.getDimensionInfo();f.selected().matches(h)?f=!1:(f=h.selectionInfo().length!==n.length?b(f.selected(),h):h,l=new c(f,f),f=!0);f=m(f,this.currentState);break;default:f=m(!1)}return f};a=this.currentState=function(){return l};
(function(a){l=a})(new c(g.createSelectionInfo(e),g.createSelectionInfo(e)))}});p.when("A").register("twister-variation-matrix",function(d){function h(b){b=d.copy(b);var e=this;this.dimCombinations=b.dimCombinations;this.validCombinatonString=" "+d.keys(b.dimCombinations).join("  ")+" ";this.dimensionInfo=b.dimensionInfo;this.dimensionList=b.dimensionList;this.dimensionDisplayText=b.dimensionDisplayText;this.config=b.config;this.dimInfoMap={};c.each(this.dimensionInfo,function(b,a){var c=
a.dimKey,d={};d.size=a.size;d.dimOrder=b;e.dimInfoMap[c]=d});this.dimtoValueMap=b.dimtoValueMap}function g(b){b=c.map(b,function(b){b=b.val;return-1===b?"\\d+":""+b}).join(":");return new RegExp("\\s"+b+"\\s","gm")}function e(b){return c.map(b,function(b){return""+b.val}).join(":")}var c=d.$;h.prototype={fetch:function(b){b=g(b);b=this.validCombinatonString.match(b);return b=c.map(b,function(b){return b.trim()})},exists:function(b){return e(b)in this.dimCombinations}};return h});p.when("A",
"jQuery").register("url-builder",function(d,h){function g(b,c){var e;if(b&&c&&"object"==typeof c){e=b;var a="?";d.each(c,function(b,d){b=c[d];e+=a+d+"="+b;a="&"})}return e}function e(b){var c;b&&(c=b.split("?")[0]);return c}function c(b){var c={};b&&(b=b.split("?"),1<b.length&&(b=b[1].split("&"),d.each(b,function(b,a){var d=b.split("=");c[d[0]]=d[1]})));return c}return{addUrlParams:function(b,d){var m=b;if(b&&d&&"object"==typeof d)var m=e(b),a=c(b),a=h.extend(a,d),m=g(m,a);return m},removeUrlParams:function(b,
f){var h=b;if(b&&f&&"object"==typeof f){var h=e(b),a=c(b);d.each(f,function(b,c){delete a[b]});h=g(h,a)}return h}}})})})(function(){var p=window.AmazonUIPageJS||window.P,n=p._namespace||p.attributeErrors;return n?n("TwisterCoreAsset"):p}(),window);